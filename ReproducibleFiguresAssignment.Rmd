---
title: "ReproducibleFiguresAssignment"
author: "Amritha Raghavan"
date: "2023-11-15"
output: html_document
---

Functions that are used throughout this assignment:
```{r}
#cleaning up column names
clean_column_names <- function(penguins_data) {
  penguins_data %>%
    clean_names()
}

#Shortening species names
shorten_species <- function(penguins_data) {
  penguins_data %>%
    mutate(species = case_when(
      species == "Adelie Penguin (Pygoscelis adeliae)" ~ "Adelie",
      species == "Chinstrap penguin (Pygoscelis antarctica)" ~ "Chinstrap",
      species == "Gentoo penguin (Pygoscelis papua)" ~ "Gentoo"
    ))
}

#Removing empty columns and rows
remove_empty_columns_rows <- function(penguins_data) {
  penguins_data %>%
    remove_empty(c("rows", "cols"))
}

```


## QUESTION 01: Data Visualisation for Science Communication

*Create a figure using the Palmer Penguin dataset that is correct but badly communicates the data. **Do not make a boxplot**.*


### a) Provide your figure here:

```{r bad figure code, echo=FALSE}
if (!requireNamespace("palmerpenguins", quietly = TRUE)) {
  install.packages("palmerpenguins")
}

if (!requireNamespace("ggplot2", quietly = TRUE)) {
  install.packages("ggplot2")
}
if (!requireNamespace("janitor", quietly = TRUE)) {
  install.packages("janitor")
}
if (!requireNamespace("dplyr", quietly = TRUE)) {
  install.packages("dplyr")
}
library("dplyr")
library("ggplot2")
library("palmerpenguins")
library("janitor")
#loading the PalmerPenguins dataset and cleaning it up
write.csv(penguins_raw, "data/penguins_raw.csv")

penguins_clean <- penguins_raw %>%
  clean_column_names() %>%
  shorten_species() %>%
  remove_empty_columns_rows()

#plotting a graph

ggplot(penguins_clean, aes(x = species, fill = island)) +
  scale_y_continuous(breaks = c(20,100,160,200))+
  geom_bar(position = "stack", stat = "count", show.legend = FALSE) +
geom_text(aes(label = sex, y = 0), position = position_dodge(width = 0.9), vjust = -0.5, size = 3) +
  facet_wrap(~sex) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  labs(title = "Bar chart displaying the palmerpenguins dataset",
       x = "Penguin Species",
       y = "Count")+
  scale_fill_manual(values=c("#F3CFC6", "pink", "lightpink"))+
  coord_cartesian(ylim= c(20,190))+
  theme_dark()+
  theme(panel.background = element_rect(fill = "#DE3163"), panel.grid.major = element_line(size = 2),
        panel.grid.minor = element_line(size = 2))
   


```

### b) Write about how your design choices mislead the reader about the underlying data (200-300 words).

The graph is not suitable for the data I am trying to convey. First, the colours used for the three different islands are almost identical, so it greatly confuses the connection between the islands and the species. Also, including the sexes of the species is irrelevant and makes the graphs much more confusing to look at.  Having no legend means there is no way to actually know what each shape and colour is displaying, also- there is no way for someone looking at the graph to actually know that the shape and colour are showing island and species, respectively. The values that the two axes start at are non-zero, which makes the graph much more confusing to look at, as well as cutting off some of the data. At first glance, the counts of each species look much smaller than they actually are. Having the scale go up so much higher than is necessary also adds to this illusion, further misreading the reader. The scale on the y axis is also very inconsistent. Additionally, having very few values actually shown on the axes makes it less clear what each measurement actually is. Including a graph for NA values for sex is unnecessary, and crowds the space, making it more difficult to read the data that is displayed. The title also does not tell you what exactly is being shown- it is vague, and there is nothing to tell the reader what is being displayed in this graph.

References:

-   [*https://www.nature.com/articles/533452a*](https://www.nature.com/articles/533452a){.uri}
-   [*https://elifesciences.org/articles/16800*](https://elifesciences.org/articles/16800){.uri}
------------------------------------------------------------------------

## QUESTION 2: Data Pipeline


### Introduction
I wanted to explore the relationship between body mass and flipper length in the Palmer penguins data set. To explore these variables, I created a scatter plot- this showed a strong linear relationship between the two, as a linear line of best fit fit the data well. using this observation, I proceeded to perform a Pearson's correlation test, to see if this observed relationship was staistically significant, and fit the hypotheses I formed. Below, you can see the scatter plot I created, and the rest of my statistical method.

```{r Data Exploration}
#Installing packages if necessary, and loading them

if (!requireNamespace("palmerpenguins", quietly = TRUE)) {
  install.packages("palmerpenguins")
}

if (!requireNamespace("ggplot2", quietly = TRUE)) {
  install.packages("ggplot2")
}
if (!requireNamespace("janitor", quietly = TRUE)) {
  install.packages("janitor")
}
if (!requireNamespace("dplyr", quietly = TRUE)) {
  install.packages("dplyr")
}
if (!requireNamespace("patchwork", quietly = TRUE)) {
  install.packages("patchwork")
}

library("ggplot2")
library("janitor")
library("palmerpenguins")
library("dplyr")
library("patchwork")
#Loading the Palmerpenguins data set, and cleaning the data

write.csv(penguins_raw, "data/penguins_raw.csv")

#Creating the 'penguins_clean' data- it has computer-readable column names, and any empty columns and rows are removed.
penguins_clean <- penguins_raw %>%
    clean_column_names() %>%
    shorten_species() %>%
    remove_empty_columns_rows()

#Creating a scatter plot to show the correlation between flipper length and body mass
FlipperLength_BodyMass_plot<- ggplot(penguins_clean, aes(x = body_mass_g, y = flipper_length_mm, )) +
  geom_point(colour="darkblue") +
    labs(title = "The relationship between body mass and flipper length",
       x = "Body Mass (g)",
       y = "Flipper Length (mm)")+
  theme(plot.title = element_text(size = 6))+
  theme_minimal()

FlipperLength_BodyMass_plot
#Installing the ragg package, to save the image
if (!requireNamespace("ragg", quietly = TRUE)) {
  install.packages("ragg")
}
library(ragg)

#Saving the objects as high resolution .png files, in the 'figures' folder
agg_png("figures/FlipperLength_BodyMass_plot.png",  width = 4000, height = 3000, units = "px", res = 600)+
print(FlipperLength_BodyMass_plot)
dev.off()
```

### Hypothesis

My hypothesis is that body mass and flipper length are positively correlated. The null hypothesis in this test is that there is no relation or correlation between these two variables, and the alternative hypothesis is that there is a positive correlation.

### Statistical Methods

In order to test this correlation, I will run a Pearson's correlation test, to find if there is a statistically significant correlation (one with a p value of <0.05). 

```{r Statistics}

correlation_test <- cor.test(penguins_clean$flipper_length_mm, penguins_clean$body_mass_g)

# Print the correlation coefficient and p-value
print(correlation_test)

```

### Results & Discussion
The p value is very low, indicating a high level of statistical significance. There is a strong positive correlation between body mass and flipper length. This correlation does not imply causation, however- it is possible that this relationship does not mean anything in terms of one variable influencing the other. Looking at the two, however, it seems feasible to say that individuals with higher body mass are probably larger overall, so they are likely to have bigger body parts, including longer flippers. To confirm this, though, more tests would need to be undertaken: there is a chance that the higher flipper length could be more closely related to a multitude of other factors, including species type, habitat, or other physical characteristics. As well as this, this test does not take into account the different sizes of the different species, so a future test which considers this may make a more accurate representation of this relationship.

```{r Plotting Results}

# Create a results figure with ggplot2
results_figure <- ggplot(penguins_clean, aes(x = body_mass_g, y = flipper_length_mm, )) +
  geom_point(colour="pink") +
  geom_smooth(method=lm, colour="#900C3F", linewidth=0.5)+
    labs(title = "Test of the correlation between body mass and flipper length",
       x = "Body Mass (g)",
       y = "Flipper Length (mm)", subtitle = "Correlation test results: r=0.871, p<2.2e-16")+
  theme(plot.title = element_text(size = 6))+
  theme_bw()

# Display the results figure
print(results_figure)

#Save the figure in the figures folder as a .png file
agg_png("figures/Results_plot.png",  width = 4000, height = 3000, units = "px", res = 600)+
print(results_figure)
dev.off()


```

In conclusion, there is a significant level of correlation between flipper length and body mass- indicating a strong, linear relationship between these two variables. However, his cannot be assumed to mean that, as body mass increases, flipper length also increases- there are too many confounding variables to be able to confidently assume this from these results. Further research into what other elements of penguin growth correlate with flipper length would be required to be able to see whether body mass truly plays a role into determining flipper length, and if one can be estimated from the other. In the future, I would perform statistical tests on more variables to determine this.

------------------------------------------------------------------------

## QUESTION 3: Open Science

### a) GitHub

*Upload your RProject you created for **Question 2** and any files and subfolders used to GitHub. Do not include any identifiers such as your name. Make sure your GitHub repo is public.*

*GitHub link:*

*You will be marked on your repo organisation and readability.*

### b) Share your repo with a partner, download, and try to run their data pipeline.

*Partner's GitHub link:*

*You **must** provide this so I can verify there is no plagiarism between you and your partner.*

### c) Reflect on your experience running their code. (300-500 words)

-   *What elements of your partner's code helped you to understand their data pipeline?*

-   *Did it run? Did you need to fix anything?*

-   *What suggestions would you make for improving their code to make it more understandable or reproducible, and why?*

-   *If you needed to alter your partner's figure using their code, do you think that would be easy or difficult, and why?*

### d) Reflect on your own code based on your experience with your partner's code and their review of yours. (300-500 words)

-   *What improvements did they suggest, and do you agree?*

-   *What did you learn about writing code for other p



